set(PXR_PREFIX pxr/imaging)
set(PXR_PACKAGE mtlf)

if (NOT ${PXR_ENABLE_METAL_SUPPORT})
    message(STATUS
        "Skipping ${PXR_PACKAGE} because PXR_ENABLE_METAL_SUPPORT is OFF")
    return()
endif()

set(optionalPublicClasses "")

set(optionalLibs "")
set(optionalIncludeDirs "")
set(OPENGL_LIBRARY "")
if (PXR_ENABLE_PTEX_SUPPORT)
    list(APPEND optionalLibs ${PTEX_LIBRARY})
    list(APPEND optionalIncludeDirs ${PTEX_INCLUDE_DIR})
endif()

if (OPENSUBDIV_HAS_METAL_COMPUTE)
    add_definitions(-DOPENSUBDIV_HAS_METAL_COMPUTE)
endif()

if (${PXR_ENABLE_GL_SUPPORT})
    SET(GLINTEROP_PRIVATE_CLASS     glInterop)
    set(OPENGL_LIBRARY              ${OPENGL_gl_LIBRARY}
                                    ${OPENGL_glu_LIBRARY}
                                    glf)
endif()

pxr_library(mtlf
    LIBRARIES
        arch
        garch
        gf
        hgiMetal
        js
        plug
        tf
        trace
        sdf
        ${Boost_PYTHON_LIBRARY}
        ${Boost_SYSTEM_LIBRARY}
        ${OPENGL_LIBRARY}
        ${OIIO_LIBRARIES}
        ${GLEW_LIBRARY}
        ${X11_LIBRARIES}
        ${OPENEXR_LIBRARY}
        ${optionalLibs}

    INCLUDE_DIRS
        ${OIIO_INCLUDE_DIRS}
        ${Boost_INCLUDE_DIRS}
        ${GLEW_INCLUDE_DIR}
        ${OPENEXR_INCLUDE_DIRS}
        ${optionalIncludeDirs}

    PUBLIC_CLASSES
        arrayTexture
        baseTexture
        bindingMap
        contextCaps
        diagnostic
        drawTarget
        info
        OSDMetalContext
        mtlDevice
        package
        ptexTexture
        resourceFactory
        simpleLightingContext
        simpleShadowArray
        udimTexture
        uniformBlock
        utils
        ${optionalPublicClasses}

    PRIVATE_CLASSES
        debugCodes
        ${GLINTEROP_PRIVATE_CLASS}

    PUBLIC_HEADERS
        api.h

    PYTHON_CPPFILES
        moduleDeps.cpp

    PYMODULE_CPPFILES
        module.cpp
        wrapDiagnostic.cpp

    PYMODULE_FILES
        __init__.py

    RESOURCE_FILES
        plugInfo.json
        shaders/pcfShader.glslfx
        shaders/simpleLighting.glslfx
        shaders/simpleShadowMapShader.glslfx
        shaders/defaults.metal
        shaders/interopFrag.glsl
        shaders/interopVtx.glsl
)
